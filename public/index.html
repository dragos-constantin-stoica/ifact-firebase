<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="icon" type="image/png" href="img/icon.png" />
    <title>iFact</title>

    <!-- Firebase UI for login -->
    <script src="https://cdn.firebase.com/libs/firebaseui/3.5.2/firebaseui.js"></script>
    <link type="text/css" rel="stylesheet" href="https://cdn.firebase.com/libs/firebaseui/3.5.2/firebaseui.css" />

    <!-- The core Firebase JS SDK is always required and must be listed first -->
    <script src="/__/firebase/6.6.1/firebase-app.js"></script>
    
    <!-- TODO: Add SDKs for Firebase products that you want to use
         https://firebase.google.com/docs/web/setup#reserved-urls -->

    <!-- include only the Firebase features as you need -->
    <!-- <script defer src="/__/firebase/6.6.1/firebase-auth.js"></script> -->
    <!-- <script defer src="/__/firebase/6.6.1/firebase-database.js"></script> -->
    <!-- <script defer src="/__/firebase/6.6.1/firebase-messaging.js"></script> -->
    <!-- <script defer src="/__/firebase/6.6.1/firebase-storage.js"></script> -->
         

    <!-- Initialize Firebase -->
    <script src="/__/firebase/init.js"></script>


    <!-- Webix -->
    <script type="text/javascript" src="https://cdn.webix.com/6.4/webix.js"></script>
    <!-- <link rel="stylesheet" type="text/css" href="https://cdn.webix.com/6.4/skins/flat.css"> -->
    <link rel="stylesheet" type="text/css" href="https://cdn.webix.com/6.4/webix.css">

    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.10/css/all.css?v=6.0.7" integrity="sha384-+d0P83n9kaQMCwj8F4RJB66tzIwOKmrdb46+porD/OvrJ+37WqIM7UoBtwHO6Nlg" crossorigin="anonymous">
    <link rel="stylesheet" type="text/css" href="https://cdn.materialdesignicons.com/2.7.94/css/materialdesignicons.css">
    <!-- Webix-Firebase adapter -->
    <script type="text/javascript" src="codebase/webix-firebase.js"></script>
    <script type="text/javascript" src="codebase/webix-firestore.js"></script>


    <!-- PDFMake -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.32/pdfmake.min.js" integrity="sha256-cLwZ62pbCLbZELPJz9RGHsawij25HU1z7qYCaBK1ZnU=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.32/vfs_fonts.js" integrity="sha256-HM47olZz1oQ8keYmS4UQy/EypVZ8gpFenpuNeYQib+g=" crossorigin="anonymous"></script>
    <!-- Handlebar framework -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/handlebars.js/4.0.10/handlebars.min.js" integrity="sha256-0JaDbGZRXlzkFbV8Xi8ZhH/zZ6QQM0Y3dCkYZ7JYq34=" crossorigin="anonymous"></script>
    <!-- SheetJS framework -->
    <script src="https://unpkg.com/xlsx/dist/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/1.3.3/FileSaver.min.js"></script>

    <!-- iFact Application -->
    <script src="js/gds.js" type="text/javascript" charset="utf-8"></script>
    <script src="js/utils.js" type="text/javascript" charset="utf-8"></script>
    <script src="js/globals.js" type="text/javascript" charset="utf-8"></script>
    <script src="js/templates.js" type="text/javascript" charset="utf-8"></script>
    <script src="js/payments.js" type="text/javascript" charset="utf-8"></script>
    <script src="js/contracts.js" type="text/javascript" charset="utf-8"></script>
    <!-- <script src="js/products.js" type="text/javascript" charset="utf-8"></script> -->
    <script src="js/customers.js" type="text/javascript" charset="utf-8"></script>
    <script src="js/invoice.js" type="text/javascript" charset="utf-8"></script>
    <script src="js/supplier.js" type="text/javascript" charset="utf-8"></script>
    <script src="js/config.js" type="text/javascript" charset="utf-8"></script>
    <!-- <script src="js/dashboard.js" type="text/javascript" charset="utf-8"></script> -->
    <script src="js/logic.js" type="text/javascript" charset="utf-8"></script>
    <script src="js/app.js" type="text/javascript" charset="utf-8"></script>


</head>

<body>

    <script src="https://www.gstatic.com/firebasejs/5.9.3/firebase.js"></script>
    <script>
        // Initialize Firebase
        var config = {
            apiKey: "AIzaSyC66woRWx4aRTJywD2uL8WHPUfQChXVIHQ",
            authDomain: "ifact-b00b5.firebaseapp.com",
            databaseURL: "https://ifact-b00b5.firebaseio.com",
            projectId: "ifact-b00b5",
            storageBucket: "ifact-b00b5.appspot.com",
            messagingSenderId: "75292245332"
        };
        firebase.initializeApp(config);
        //var db = firebase.firestore();
        //create firebase connection, and assign it to webix
        webix.firestore = firebase.firestore();
        var fbfs = firebase.firestore;
        var fbstorage = firebase.storage().ref();
    </script>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // // ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥
            // // The Firebase SDK is initialized and available here!
            //
            // firebase.auth().onAuthStateChanged(user => { });
            // firebase.database().ref('/path/to/ref').on('value', snapshot => { });
            // firebase.messaging().requestPermission().then(() => { });
            // firebase.storage().ref('/path/to/ref').getDownloadURL().then(() => { });
            //
            // // ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥

            try {
                let app = firebase.app();
                let features = ['auth', 'database', 'messaging', 'storage'].filter(feature => typeof app[feature] === 'function');

                var provider = new firebase.auth.GoogleAuthProvider();

                // Initialize the FirebaseUI Widget using Firebase.
                var ui = new firebaseui.auth.AuthUI(firebase.auth());

                var uiConfig = {
                    callbacks: {
                        signInSuccessWithAuthResult: function (authResult, redirectUrl) {
                            // User successfully signed in.
                            // Return type determines whether we continue the redirect automatically
                            // or whether we leave that to developer to handle.

                            // This gives you a Google Access Token. You can use it to access the Google API.
                            var token = authResult.credential.accessToken;
                            // The signed-in user info.
                            var user = authResult.user;
                            USERNAME.setUSERNAME(user);

                            document.getElementById('firebaseui-auth-container').style.display = 'none';
                            console.log(user);

                            //user is now logged in and we can show the UI
                            webix.env.cdn = "//cdn.webix.com";
                            //This is a Single Page Application
                            //it is designed for Desktop browsers

                            webix.i18n.parseFormat = "%d.%m.%Y";
                            webix.i18n.setLocale();

                            webix.ready(function () {
                                myApp.init();
                            });


                            return true;
                        },
                        uiShown: function () {
                            // The widget is rendered.
                            // Hide the loader.
                            document.getElementById('loader').style.display = 'none';

                            //already authentified
                            if (USERNAME.getUSERNAME()) {
                                document.getElementById('firebaseui-auth-container').style.display = 'none';
                                //user is now logged in and we can show the UI
                                webix.env.cdn = "//cdn.webix.com";
                                //This is a Single Page Application
                                //it is designed for Desktop browsers

                                webix.i18n.parseFormat = "%d.%m.%Y";
                                webix.i18n.setLocale();

                                webix.ready(function () {
                                    myApp.init();
                                });
                            };

                        }
                    },
                    // Will use popup for IDP Providers sign-in flow instead of the default, redirect.
                    //signInFlow: 'popup',
                    signInSuccessUrl: '#',
                    signInOptions: [
                        // Leave the lines as is for the providers you want to offer your users.
                        firebase.auth.GoogleAuthProvider.PROVIDER_ID,
                        //firebase.auth.FacebookAuthProvider.PROVIDER_ID,
                        firebase.auth.TwitterAuthProvider.PROVIDER_ID,
                        firebase.auth.GithubAuthProvider.PROVIDER_ID,
                        //firebase.auth.EmailAuthProvider.PROVIDER_ID,
                        //firebase.auth.PhoneAuthProvider.PROVIDER_ID
                    ],
                    // Terms of service url.
                    tosUrl: '<your-tos-url>',
                    // Privacy policy url.
                    privacyPolicyUrl: '<your-privacy-policy-url>'
                };

                // The start method will wait until the DOM is loaded.
                ui.start('#firebaseui-auth-container', uiConfig);

                /*
                firebase.auth().signInWithPopup(provider).then(function(result) {
                    // This gives you a Google Access Token. You can use it to access the Google API.
                    var token = result.credential.accessToken;
                    // The signed-in user info.
                    var user = result.user;
                    USERNAME.setUSERNAME(user);

                    console.log(user);

                    //user is now logged in and we can show the UI
                    webix.env.cdn = "//cdn.webix.com";
                    //This is a Single Page Application
                    //it is designed for Desktop browsers
                    
                    webix.i18n.parseFormat = "%d.%m.%Y";
                    webix.i18n.setLocale();

                    webix.ready(function() {
                        myApp.init();
                    });

                }).catch(function(error) {
                    // Handle Errors here.
                    var errorCode = error.code;
                    var errorMessage = error.message;
                    // The email of the user's account used.
                    var email = error.email;
                    // The firebase.auth.AuthCredential type that was used.
                    var credential = error.credential;


                    USERNAME.delUSERNAME();
                    if (!webix.isUndefined($$('mainLayout'))) $$('mainLayout').destructor();
                    if (!webix.isUndefined($$('sidemenu'))) $$('sidemenu').destructor();
                    myApp.init();

                    console.error(error);
                });
                */                

            } catch (e) {
                console.error(e);
            }
        });
    </script>


<!-- The surrounding HTML is left untouched by FirebaseUI.
     Your app may use that space for branding, controls and other customizations.-->
<div id="firebaseui-auth-container"></div>
<div id="loader">Loading...</div>



</body>

</html>